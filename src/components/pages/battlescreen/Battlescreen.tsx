import AllyIcon from "./AllyIcon";
import BattleLog from "./Battlelog";
import MovesPanel from "./MovesPanel";
import { useBattleLog } from "../../../hooks/useBattleLog";
import "./BattleScreen.css";

/**
 * BattleScreen Component
 * 
 * ARCHITECTURE IMPLEMENTATION (I.3 Requirement):
 * 
 * This component demonstrates the complete hook-service-repository architecture:
 * 
 * 1. HOOK (useBattleLog): 
 *    - Manages presentation logic for battle log messages
 *    - Provides state (messages, error) and actions (handleAttack, handleSkill, etc.)
 *    - Reusable across any component that needs battle log functionality
 * 
 * 2. SERVICE (battleLogService):
 *    - Contains business logic for battle actions
 *    - Determines damage values, message formatting, action sequences
 *    - Example: processAttackAction() knows that attacks should show ally message + enemy damage response
 * 
 * 3. REPOSITORY (battleLogRepository):
 *    - Handles all data access (CRUD operations)
 *    - Currently uses test data, will connect to backend API in next sprint
 *    - Provides abstraction layer so business logic doesn't care about data source
 * 
 * FLOW EXAMPLE (Attack button clicked):
 * BattleScreen → useBattleLog.handleAttack() → 
 * battleLogService.processAttackAction() → 
 * battleLogRepository.createMessage() → 
 * Update state → Re-render with new messages
 * 
 * This separation of concerns makes the code:
 * - Easier to test (each layer can be tested independently)
 * - Easier to maintain (changes to data source don't affect business logic)
 * - More reusable (hook can be used in other components like a battle replay viewer)
 */

function BattleScreen() {
    // Use the custom hook to get battle log state and actions
    // Pass empty dependencies array - messages refresh on every action
    const {
        messages,
        error,
        handleAttack,
        handleSkill,
        handleMovement,
        handleGuard
    } = useBattleLog([]);

    return (
        <div className="battle-screen">
            {/* Battle Area */}
            <div className="battle-area">
                {/* Enemy Section */}
                <div className="enemy-container">
                    <div className="enemy-placeholder">E</div>
                </div>

                {/* Allies Section */}
                <div className="allies-container">
                    <div className="ally-sprite">A1</div>
                    <div className="ally-sprite">A2</div>
                    <div className="ally-sprite">A3</div>
                    <div className="ally-sprite">A4</div>
                </div>
            </div>

            {/* Bottom UI Panel */}
            <div className="battle-ui">
                {/* Move Buttons - Pass handlers from the hook */}
                <MovesPanel 
                    onAttack={handleAttack}
                    onSkills={handleSkill}
                    onMovement={handleMovement}
                    onGuard={handleGuard}
                />

                {/* Battle Log - Pass messages from the hook, show error if present */}
                {error ? (
                    <div className="battle-log">
                        <span className="error">Something went wrong: ({error})</span>
                    </div>
                ) : (
                    <BattleLog messages={messages} />
                )}

                {/* Ally Icons */}
                <div className="ally-icons-panel">
                    <AllyIcon />
                    <AllyIcon />
                    <AllyIcon />
                    <AllyIcon />
                </div>
            </div>
        </div>
    );
}

export default BattleScreen;



// import { useState } from "react";
// import AllyIcon from "./AllyIcon";
// import BattleLog from "./Battlelog";
// import MovesPanel from "./MovesPanel";
// import "./BattleScreen.css";

// export interface LogMessage {
//     id: number;
//     type: 'system' | 'ally' | 'enemy';
//     text: string;
// }

// function BattleScreen() {
//     const [battleLog, setBattleLog] = useState<LogMessage[]>([
//         { id: 1, type: 'system', text: 'Battle has begun!' }
//     ]);
//     const [messageId, setMessageId] = useState(2);

//     const addLogMessage = (type: 'system' | 'ally' | 'enemy', text: string) => {
//         const newMessage: LogMessage = {
//             id: messageId,
//             type,
//             text
//         };
//         setBattleLog(prev => [...prev, newMessage]);
//         setMessageId(prev => prev + 1);
//     };

//     const handleAttack = () => {
//         addLogMessage('ally', 'You strike the enemy with your sword!');
        
//         // Simulate enemy response after a short delay
//         setTimeout(() => {
//             addLogMessage('enemy', 'The enemy takes 15 damage!');
//         }, 800);
//     };

//     const handleSkills = () => {
//         addLogMessage('ally', 'You cast Fireball on the enemy!');
        
//         // Simulate enemy response after a short delay
//         setTimeout(() => {
//             addLogMessage('enemy', 'The enemy is engulfed in flames! 25 damage!');
//         }, 800);
//     };

//     const handleMovement = () => {
//         // Placeholder for movement functionality
//         addLogMessage('system', 'Movement option selected.');
//     };

//     const handleGuard = () => {
//         // Placeholder for guard functionality
//         addLogMessage('system', 'You raise your shield in defense.');
//     };

//     return (
//         <div className="battle-screen">
//             {/* Battle Area */}
//             <div className="battle-area">
//                 {/* Enemy Section */}
//                 <div className="enemy-container">
//                     <div className="enemy-placeholder">E</div>
//                 </div>

//                 {/* Allies Section */}
//                 <div className="allies-container">
//                     <div className="ally-sprite">A1</div>
//                     <div className="ally-sprite">A2</div>
//                     <div className="ally-sprite">A3</div>
//                     <div className="ally-sprite">A4</div>
//                 </div>
//             </div>

//             {/* Bottom UI Panel */}
//             <div className="battle-ui">
//                 {/* Move Buttons */}
//                 <MovesPanel 
//                     onAttack={handleAttack}
//                     onSkills={handleSkills}
//                     onMovement={handleMovement}
//                     onGuard={handleGuard}
//                 />

//                 {/* Battle Log */}
//                 <BattleLog messages={battleLog} />

//                 {/* Ally Icons */}
//                 <div className="ally-icons-panel">
//                     <AllyIcon />
//                     <AllyIcon />
//                     <AllyIcon />
//                     <AllyIcon />
//                 </div>
//             </div>
//         </div>
//     );
// }

// export default BattleScreen;